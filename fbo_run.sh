#!/usr/bin/env bash
#----------------------------------------------------------
# This script runs the MR program for flights by Origin
# It then scan the result in /tmp folder.
# It then replace 'tab' \t with spaces (' ') so that it
# can perform a match with input #3.
#----------------------------------------------------------
echo './fbo_run.sh input-path output-path'
hdfs dfs -rm -r $2
yarn jar /usr/local/hadoop/share/hadoop/tools/lib/hadoop-streaming*.jar \
  -mapper app/FlightsByOriginMapper.py \
  -reducer app/FlightsByOriginReducer.py -file app/FlightsByOriginMapper.py -file app/FlightsByOriginReducer.py -input $1 -output $2

value=$(hdfs dfs -cat $2/part-00000)
value=$(echo $value | sed -r 's/\t/ /g')
echo $value

if [[ $value == *"$3"* ]]; then
  echo "FlightsByOrigin runs successfully ($1)!"
else
  echo "FlightsByOrigin runs UNsuccessfully ($1)"
  echo "Search: '$3'"
  echo "Actual:"; echo "$value"
fi

# 2003 result:
#ABE 4071 ABI 2529 ABQ 36708 ABY 1449 ACK 193 ACT 2736 ACV 4027 ACY 132 ADK 74 ADQ 726 AEX 3261 AGS 4321 AKN 347 ALB 17098 AMA 8368 ANC 21013 ATL 368743 ATW 1087 AUS 41015 AVL 3680 AVP 865 AZO 3202 BDL 33567 BET 1175 BFF 1 BFL 2758 BGM 1184 BGR 4077 BHM 19233 BIL 4339 BIS 1846 BMI 1954 BNA 55585 BOI 15038 BOS 115460 BPT 1601 BQK 1423 BQN 294 BRO 1736 BRW 724 BTM 1377 BTR 7494 BTV 7188 BUF 21762 BUR 26362 BWI 99255 BZN 4043 CAE 9492 CAK 4453 CDC 1070 CDV 726 CEC 1203 CHA 3836 CHO 2649 CHS 9900 CIC 1092 CID 5462 CLD 2139 CLE 90094 CLL 3255 CLT 103417 CMH 35356 CMI 1948 COD 839 COS 11952 CPR 2121 CRP 7863 CRW 5551 CSG 2197 CVG 92595 CYS 1 DAB 3013 DAL 45393 DAY 12919 DBQ 1074 DCA 79120 DEN 141824 DFW 332579 DHN 1818 DLG 283 DLH 1207 DRO 1549 DSM 9331 DTW 139844 DUT 689 EFD 1572 EGE 1093 EKO 3007 ELP 20174 ERI 61 EUG 3949 EVV 4284 EWR 150412 EYW 809 FAI 5420 FAR 4220 FAT 13645 FAY 1770 FCA 1865 FLL 60478 FLO 1056 FMN 2 FNT 3246 FSD 3305 FSM 2207 FWA 6097 GEG 14489 GFK 898 GGG 1289 GJT 3881 GNV 2431 GPT 5747 GRB 4707 GRR 12801 GSO 14157 GSP 11970 GST 91 GTF 2680 GTR 1985 GUC 229 HDN 643 HLN 1301 HNL 15660 HOU 57375 HPN 8273 HRL 5711 HSV 6798 HTS 1095 IAD 103386 IAH 185182 ICT 10090 IDA 3317 ILE 4508 ILM 3337 IND 41617 IPL 744 ISP 10785 ITO 357 IYK 1074 JAC 4156 JAN 10117 JAX 26048 JFK 74506 JNU 4504 KOA 2386 KTN 2479 LAN 4845 LAS 143179 LAW 2132 LAX 223971 LBB 9913 LCH 1546 LEX 6808 LFT 3966 LGA 106731 LGB 10560 LIH 2506 LIT 16198 LNK 1746 LNY 61 LRD 2300 LSE 1651 LWB 193 LYH 1095 MAF 8253 MBS 3939 MCI 59533 MCN 1753 MCO 93171 MDT 8435 MDW 85831 MEI 1578 MEM 50037 MFE 3063 MFR 4250 MGM 3645 MHT 19246 MIA 61692 MKE 20946 MKK 61 MLB 2354 MLI 2722 MLU 3509 MOB 4949 MOD 1383 MOT 1104 MQT 311 MRY 7437 MSN 7583 MSO 3268 MSP 144836 MSY 52334 MTJ 2188 MYR 5565 OAK 67279 OGD 1 OGG 6274 OKC 23844 OMA 20355 OME 1074 ONT 35459 ORD 366705 ORF 22365 OTZ 1072 OXR 1750 PBI 25165 PDX 55450 PFN 3242 PHF 4395 PHL 108742 PHX 169895 PIA 3758 PIE 2466 PIH 1806 PIT 65090 PNS 6815 PSC 3174 PSG 726 PSP 12369 PVD 27945 PWM 9783 RAP 4093 RDD 2243 RDM 2588 RDU 51341 RIC 15711 RNO 27591 ROA 4846 ROC 15590 RST 1910 RSW 18981 SAN 82700 SAT 39083 SAV 8850 SBA 11008 SBN 3027 SBP 5596 SCC 404 SCE 1455 SDF 20800 SEA 104605 SFO 122334 SGF 4216 SGU 3107 SHV 8186 SIT 1296 SJC 62884 SJT 2379 SJU 24219 SLC 125545 SMF 46747 SMX 2131 SNA 46647 SPS 2059 SRQ 4206 STL 100904 STT 3116 STX 630 SUN 3201 SUX 1 SWF 1807 SYR 12785 TLH 3734 TOL 4429 TPA 66671 TRI 2980 TUL 21850 TUS 18311 TVC 2211 TWF 2034 TXK 1796 TYR 3025 TYS 10656 VCT 896 VIS 869 VLD 1481 VPS 5412 WRG 726 WYS 333 XNA 10400 YAK 726 YUM 1351

